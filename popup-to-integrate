<!-- ============================================
     AJOUTER CE CODE √Ä LA FIN DE VOTRE HTML
     (Juste avant la balise </div> finale)
     ============================================ -->

<!-- MODAL DE R√âAFFECTATION -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeReassignmentModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Bouton de fermeture -->
    <button class="modal-close-btn" (click)="closeReassignmentModal()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
      </svg>
    </button>

    <div class="modal-content">
      
      <!-- Section 1: Situation actuelle -->
      <div class="modal-section">
        <h2 class="modal-section-title">Situation actuelle</h2>
        <div class="modal-table-wrapper">
          <table class="modal-table">
            <thead>
              <tr>
                <th>Date de r√©ception</th>
                <th>Type de demande(s)</th>
                <th>Nom & pr√©nom client(s)</th>
                <th>Identifiant SAB</th>
                <th>Propri√©taire de la demande</th>
                <th>Entit√© propri√©taire</th>
                <th>Statut</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>07/07/2025</strong></td>
                <td>
                  <div class="modal-type-cell">
                    <div class="modal-icon-circle"></div>
                    <span><strong>D√©rogation tarifaire</strong></span>
                  </div>
                </td>
                <td><strong>Amine TALBI</strong></td>
                <td><strong>8939782</strong></td>
                <td>
                  <div class="modal-owner-cell">
                    <div class="modal-owner-icon"></div>
                    <span><strong>Ghita ALAMI</strong></span>
                  </div>
                </td>
                <td><strong>Agence MED V</strong></td>
                <td>
                  <div class="modal-status">
                    <div class="modal-status-dot"></div>
                    <span><strong>En attente</strong></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Section 2: R√©affectation -->
      <div class="modal-section">
        <h2 class="modal-section-title">R√©affectation</h2>
        <div class="modal-table-wrapper">
          <table class="modal-table">
            <thead>
              <tr>
                <th>Date de r√©ception</th>
                <th>Type de demande(s)</th>
                <th>Nom & pr√©nom client(s)</th>
                <th>Identifiant SAB</th>
                <th>Propri√©taire de la demande</th>
                <th>Entit√© propri√©taire</th>
                <th>Statut</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>07/07/2025</strong></td>
                <td>
                  <div class="modal-type-cell">
                    <div class="modal-icon-circle"></div>
                    <span><strong>D√©rogation tarifaire</strong></span>
                  </div>
                </td>
                <td><strong>Amine TALBI</strong></td>
                <td><strong>8939782</strong></td>
                <td>
                  <div class="modal-owner-reassigned">
                    <div class="modal-owner-icon"></div>
                    <span><strong>Touria HAFSI</strong></span>
                    <span class="modal-checkmark">‚úì</span>
                  </div>
                </td>
                <td><strong>Agence MED V</strong></td>
                <td>
                  <div class="modal-status">
                    <div class="modal-status-dot"></div>
                    <span><strong>En attente</strong></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Bouton de confirmation -->
      <div class="modal-button-container">
        <button class="modal-confirm-button" (click)="confirmReassignment()">
          <span class="modal-arrow">‚Üí</span>
          CONFIRMER LA R√âAFFECTATION
        </button>
      </div>

    </div>
  </div>
</div>


/* ============================================
   AJOUTER CE CODE √Ä LA FIN DE VOTRE SCSS
   ============================================ */

/* ============================================
   STYLES DU MODAL DE R√âAFFECTATION
   ============================================ */

/* Overlay du modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  padding: 20px;
  animation: fadeIn 0.3s ease;

  @media (max-width: 768px) {
    padding: 10px;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Container du modal */
.modal-container {
  background: #ffffff;
  border-radius: 20px;
  max-width: 1400px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.3s ease;

  @media (max-width: 768px) {
    max-height: 95vh;
    border-radius: 12px;
  }

  /* Scrollbar personnalis√©e */
  &::-webkit-scrollbar {
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  &::-webkit-scrollbar-thumb {
    background: #4CAF50;
    border-radius: 10px;

    &:hover {
      background: #45a049;
    }
  }
}

@keyframes slideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Bouton de fermeture */
.modal-close-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  background: #f5f5f5;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;

  @media (max-width: 768px) {
    top: 10px;
    right: 10px;
    width: 36px;
    height: 36px;
  }

  svg {
    color: #666;
    transition: color 0.3s ease;
  }

  &:hover {
    background: #e0e0e0;
    transform: rotate(90deg);

    svg {
      color: #333;
    }
  }
}

/* Contenu du modal */
.modal-content {
  padding: 50px 40px 40px;

  @media (max-width: 768px) {
    padding: 50px 20px 30px;
  }

  @media (max-width: 480px) {
    padding: 45px 15px 25px;
  }
}

/* Sections du modal */
.modal-section {
  margin-bottom: 40px;

  @media (max-width: 768px) {
    margin-bottom: 30px;
  }

  &:last-of-type {
    margin-bottom: 20px;
  }
}

.modal-section-title {
  color: #059669;
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 25px;

  @media (max-width: 768px) {
    font-size: 22px;
    margin-bottom: 20px;
  }

  @media (max-width: 480px) {
    font-size: 18px;
    margin-bottom: 15px;
  }
}

/* Wrapper du tableau modal */
.modal-table-wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;

  &::-webkit-scrollbar {
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  &::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
  }
}

/* Tableau du modal */
.modal-table {
  width: 100%;
  border-collapse: collapse;

  thead th {
    color: #059669;
    font-weight: 600;
    font-size: 14px;
    padding: 15px 10px;
    text-align: left;
    border-bottom: 2px solid #e5e7eb;
    white-space: nowrap;

    @media (max-width: 768px) {
      font-size: 12px;
      padding: 12px 8px;
    }

    @media (max-width: 480px) {
      font-size: 11px;
      padding: 10px 6px;
    }
  }

  tbody td {
    padding: 20px 10px;
    font-size: 15px;
    color: #1f2937;
    border-bottom: 1px solid #e5e7eb;
    white-space: nowrap;

    @media (max-width: 768px) {
      font-size: 13px;
      padding: 15px 8px;
    }

    @media (max-width: 480px) {
      font-size: 12px;
      padding: 12px 6px;
    }
  }
}

/* Type de demande dans le modal */
.modal-type-cell {
  display: flex;
  align-items: center;
  gap: 10px;

  @media (max-width: 480px) {
    flex-direction: column;
    gap: 5px;
  }
}

.modal-icon-circle {
  width: 28px;
  height: 28px;
  border: 3px solid #059669;
  border-radius: 50%;
  flex-shrink: 0;

  @media (max-width: 480px) {
    width: 24px;
    height: 24px;
    border-width: 2px;
  }
}

/* Propri√©taire dans le modal */
.modal-owner-cell {
  display: flex;
  align-items: center;
  gap: 10px;

  @media (max-width: 480px) {
    flex-direction: column;
    gap: 5px;
  }
}

.modal-owner-icon {
  width: 32px;
  height: 32px;
  background-color: #93c5fd;
  border-radius: 50%;
  flex-shrink: 0;

  @media (max-width: 480px) {
    width: 28px;
    height: 28px;
  }
}

/* Propri√©taire r√©affect√© */
.modal-owner-reassigned {
  border: 2px solid #059669;
  padding: 8px 16px;
  border-radius: 25px;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  background-color: #f0fdf4;

  @media (max-width: 480px) {
    padding: 6px 12px;
    gap: 8px;
  }

  .modal-owner-icon {
    width: 28px;
    height: 28px;

    @media (max-width: 480px) {
      width: 24px;
      height: 24px;
    }
  }
}

.modal-checkmark {
  color: #059669;
  font-size: 20px;
  font-weight: bold;

  @media (max-width: 480px) {
    font-size: 18px;
  }
}

/* Statut dans le modal */
.modal-status {
  display: flex;
  align-items: center;
  gap: 8px;

  @media (max-width: 480px) {
    flex-direction: column;
    gap: 5px;
  }
}

.modal-status-dot {
  width: 16px;
  height: 16px;
  background-color: #f59e0b;
  border-radius: 50%;
  flex-shrink: 0;

  @media (max-width: 480px) {
    width: 14px;
    height: 14px;
  }
}

/* Container du bouton */
.modal-button-container {
  display: flex;
  justify-content: center;
  margin-top: 40px;

  @media (max-width: 768px) {
    margin-top: 30px;
  }
}

/* Bouton de confirmation */
.modal-confirm-button {
  background-color: #059669;
  color: white;
  border: none;
  padding: 18px 50px;
  border-radius: 50px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);

  @media (max-width: 768px) {
    padding: 15px 40px;
    font-size: 14px;
  }

  @media (max-width: 480px) {
    padding: 12px 30px;
    font-size: 13px;
    gap: 10px;
  }

  &:hover {
    background-color: #047857;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(5, 150, 105, 0.4);
  }

  &:active {
    transform: translateY(0);
  }
}

.modal-arrow {
  font-size: 24px;
  font-weight: bold;

  @media (max-width: 480px) {
    font-size: 20px;
  }
}

/* Responsive pour tr√®s petits √©crans */
@media (max-width: 480px) {
  .modal-table {
    font-size: 11px;

    thead th {
      padding: 8px 4px;
    }

    tbody td {
      padding: 10px 4px;
    }
  }
}

// ============================================
// CODE √Ä AJOUTER DANS VOTRE .TS
// ============================================

// 1Ô∏è‚É£ AJOUTER CES PROPRI√âT√âS dans la classe (apr√®s les propri√©t√©s existantes)
// ============================================

  // Gestion du modal de r√©affectation
  isModalOpen = false;
  selectedRequest: DerogationRequest | null = null;


// 2Ô∏è‚É£ AJOUTER CES M√âTHODES dans la classe (apr√®s les m√©thodes existantes)
// ============================================

  /**
   * Ouvre le modal de r√©affectation
   */
  openReassignmentModal(request: DerogationRequest): void {
    this.selectedRequest = request;
    this.isModalOpen = true;
    // Emp√™cher le scroll du body quand le modal est ouvert
    document.body.style.overflow = 'hidden';
  }

  /**
   * Ferme le modal de r√©affectation
   */
  closeReassignmentModal(): void {
    this.isModalOpen = false;
    this.selectedRequest = null;
    // Restaurer le scroll du body
    document.body.style.overflow = 'auto';
  }

  /**
   * Confirme la r√©affectation
   */
  confirmReassignment(): void {
    if (!this.selectedRequest || !this.selectedRequest.id) {
      console.error('Aucune demande s√©lectionn√©e');
      return;
    }

    console.log('Confirmation de la r√©affectation pour:', this.selectedRequest);
    
    // TODO: Appeler votre service pour effectuer la r√©affectation
    // Exemple:
    // this.dashboardService.reassignDemand(this.selectedRequest.id, newOwnerId)
    //   .subscribe({
    //     next: () => {
    //       this.closeReassignmentModal();
    //       this.loadAllData();
    //     }
    //   });

    // Pour l'instant, juste fermer le modal
    this.closeReassignmentModal();
    alert('R√©affectation confirm√©e (version statique)');
  }


// 3Ô∏è‚É£ MODIFIER LA M√âTHODE processRequest existante
// ============================================
// Remplacer votre m√©thode processRequest actuelle par celle-ci:

  processRequest(request: DerogationRequest): void {
    // Ouvre le modal au lieu de traiter directement
    this.openReassignmentModal(request);
  }


// ============================================
// POURQUOI ON A BESOIN DU TYPESCRIPT ?
// ============================================

/*
Le TypeScript est N√âCESSAIRE pour :

1. isModalOpen : 
   - Variable qui contr√¥le l'affichage du modal
   - Dans le HTML : *ngIf="isModalOpen"
   - Sans cette variable, le modal ne s'affichera JAMAIS

2. selectedRequest :
   - Stocke la demande sur laquelle on a cliqu√©
   - Permet d'afficher ses donn√©es dans le modal
   - Utile pour envoyer les bonnes donn√©es √† l'API

3. openReassignmentModal() :
   - Fonction appel√©e quand on clique sur "TRAITER"
   - Met isModalOpen = true pour afficher le modal
   - Bloque le scroll de la page (document.body.style.overflow)

4. closeReassignmentModal() :
   - Fonction appel√©e pour fermer le modal
   - Met isModalOpen = false pour cacher le modal
   - Restaure le scroll de la page

5. confirmReassignment() :
   - Fonction appel√©e quand on clique sur "CONFIRMER"
   - C'est ici que vous appellerez votre API plus tard
   - Pour l'instant, elle ferme juste le modal

SANS LE TYPESCRIPT, LE MODAL NE FONCTIONNERA PAS !
Le HTML fait r√©f√©rence √† ces fonctions et variables TypeScript.
*/






<td>
  <div class="modal-owner-select-container">
    <select class="modal-owner-select" [(ngModel)]="selectedNewOwner">
      <option value="">-- S√©lectionner un propri√©taire --</option>
      <option value="user1">Touria HAFSI</option>
      <option value="user2">Mohammed BENNANI</option>
      <option value="user3">Fatima ALAOUI</option>
      <option value="user4">Youssef IDRISSI</option>
      <option value="user5">Samira KADIRI</option>
    </select>
    <svg class="modal-select-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
      <path d="M7,10L12,15L17,10H7Z"/>
    </svg>
  </div>
</td>




* Container du select pour le propri√©taire */
.modal-owner-select-container {
  position: relative;
  display: inline-block;
  width: 100%;
  max-width: 300px;

  @media (max-width: 768px) {
    max-width: 100%;
  }
}

/* Style du select (liste d√©roulante) */
.modal-owner-select {
  width: 100%;
  padding: 10px 35px 10px 15px;
  border: 2px solid #059669;
  border-radius: 25px;
  background-color: #f0fdf4;
  color: #1f2937;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  outline: none;
  transition: all 0.3s ease;

  @media (max-width: 768px) {
    font-size: 13px;
    padding: 8px 30px 8px 12px;
  }

  @media (max-width: 480px) {
    font-size: 12px;
    padding: 7px 28px 7px 10px;
  }

  /* √âtat hover */
  &:hover {
    border-color: #047857;
    background-color: #dcfce7;
  }

  /* √âtat focus */
  &:focus {
    border-color: #047857;
    background-color: #ffffff;
    box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
  }

  /* Option par d√©faut (placeholder) */
  option[value=""] {
    color: #9ca3af;
  }

  /* Options normales */
  option {
    color: #1f2937;
    background-color: #ffffff;
    padding: 10px;
  }
}

/* Ic√¥ne fl√®che du select */
.modal-select-arrow {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: #059669;
  transition: transform 0.3s ease;

  @media (max-width: 480px) {
    right: 8px;
    width: 14px;
    height: 14px;
  }
}

/* Animation de la fl√®che quand le select est ouvert */
.modal-owner-select:focus + .modal-select-arrow {
  transform: translateY(-50%) rotate(180deg);
}

/* Style quand une option est s√©lectionn√©e */
.modal-owner-select:not([value=""]) {
  background-color: #dcfce7;
  font-weight: 700;
}

/* Style pour navigateurs Firefox */
@-moz-document url-prefix() {
  .modal-owner-select {
    padding-right: 30px;
  }
}







// ============================================
// CODE √Ä AJOUTER/MODIFIER DANS VOTRE .TS
// ============================================

// 1Ô∏è‚É£ AJOUTER CETTE PROPRI√âT√â (avec les autres propri√©t√©s du modal)
// ============================================

  // Gestion du modal de r√©affectation
  isModalOpen = false;
  selectedRequest: DerogationRequest | null = null;
  selectedNewOwner: string = ''; // üëà NOUVELLE PROPRI√âT√â pour le dropdown


// 2Ô∏è‚É£ MODIFIER LA M√âTHODE openReassignmentModal
// ============================================

  openReassignmentModal(request: DerogationRequest): void {
    this.selectedRequest = request;
    this.selectedNewOwner = ''; // R√©initialiser le select √† chaque ouverture
    this.isModalOpen = true;
    document.body.style.overflow = 'hidden';
  }


// 3Ô∏è‚É£ MODIFIER LA M√âTHODE confirmReassignment
// ============================================

  confirmReassignment(): void {
    if (!this.selectedRequest || !this.selectedRequest.id) {
      console.error('Aucune demande s√©lectionn√©e');
      return;
    }

    // V√©rifier qu'un nouveau propri√©taire a √©t√© s√©lectionn√©
    if (!this.selectedNewOwner) {
      alert('Veuillez s√©lectionner un nouveau propri√©taire');
      return;
    }

    console.log('R√©affectation de la demande:', this.selectedRequest.id);
    console.log('Nouveau propri√©taire:', this.selectedNewOwner);
    
    // TODO: Appeler votre service pour effectuer la r√©affectation
    // Exemple:
    // this.dashboardService.reassignDemand(
    //   this.selectedRequest.id, 
    //   this.selectedNewOwner
    // ).subscribe({
    //   next: () => {
    //     this.closeReassignmentModal();
    //     this.loadAllData();
    //     alert('R√©affectation effectu√©e avec succ√®s');
    //   },
    //   error: (error) => {
    //     console.error('Erreur:', error);
    //     alert('Erreur lors de la r√©affectation');
    //   }
    // });

    // Pour l'instant (version statique)
    this.closeReassignmentModal();
    alert(`R√©affectation confirm√©e vers: ${this.selectedNewOwner}`);
  }


// ============================================
// OPTIONNEL : Liste des propri√©taires depuis l'API
// ============================================

// Si vous voulez charger la liste des propri√©taires depuis une API:

  // Propri√©t√© pour stocker la liste
  availableOwners: any[] = [];

  // M√©thode pour charger la liste
  loadAvailableOwners(): void {
    // TODO: Appeler votre service
    // this.dashboardService.getAvailableOwners().subscribe({
    //   next: (owners) => {
    //     this.availableOwners = owners;
    //   }
    // });

    // Pour l'instant, donn√©es statiques
    this.availableOwners = [
      { id: 'user1', name: 'Touria HAFSI' },
      { id: 'user2', name: 'Mohammed BENNANI' },
      { id: 'user3', name: 'Fatima ALAOUI' },
      { id: 'user4', name: 'Youssef IDRISSI' },
      { id: 'user5', name: 'Samira KADIRI' }
    ];
  }

  // Appeler dans ngOnInit
  ngOnInit(): void {
    this.loadAllData();
    this.loadAvailableOwners(); // üëà Charger la liste des propri√©taires
  }

// Puis dans le HTML, utiliser *ngFor:
// <option *ngFor="let owner of availableOwners" [value]="owner.id">
//   {{ owner.name }}
// </option>


// ============================================
// IMPORTANT : Ajouter FormsModule dans votre module
// ============================================

/*
Dans votre module Angular (probablement derogation.module.ts ou app.module.ts),
vous devez importer FormsModule pour que [(ngModel)] fonctionne:

import { FormsModule } from '@angular/forms';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,  // üëà AJOUTER CECI
    // ... autres imports
  ],
  // ...
})
export class DerogationModule { }

SI VOUS NE FAITES PAS √áA, Angular affichera une erreur !
*/
