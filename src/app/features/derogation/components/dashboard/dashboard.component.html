<div class="dashboard-container">
  
  <div class="section-header">

      <!-- Ajoutez aprÃ¨s section-header -->
  <div class="success-message" *ngIf="successMessage">
    {{ successMessage }}
  </div>
    <h2>QuickFlow - Gestion des demandes de dÃ©rogation</h2>
    <!-- BOUTON NOUVELLE DEMANDE -->
    <button class="btn-new-request" (click)="onNewRequest()">
      + NOUVELLE DEMANDE
    </button>
  </div>

  <!-- Section 1: Demandes Ã  traiter -->
  <div class="workflow-section">
    <div class="section-title">
      <div class="status-icon status-to-process">
        <i class="icon-section-placeholder">âœ“</i>
      </div>
      <h3>Demandes Ã  traiter</h3>
    </div>
    
    <div class="requests-table" *ngIf="(requestsToProcess$ | async) && (requestsToProcess$ | async)!.length > 0">
      <table>
        <thead>
          <tr>
            <th style="width: 120px;">NÂ° de demande</th>
            <th style="width: 150px;">Type de demande</th>
            <th style="width: 180px;">Nom Ã  prÃ©nom client</th>
            <th style="width: 120px;">Identifiant SAB</th>
            <th style="width: 180px;">Responsable de la demande</th>
            <th style="width: 150px;">EntitÃ© propriÃ©taire</th>
            <th style="width: 100px;">Statut</th>
            <th style="width: 100px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of requestsToProcess$ | async">
            <td>
              <div class="request-id">
                <div class="request-icon">
                  <i class="icon-row-placeholder">âœ“</i>
                </div>
                {{ request.id.toString().padStart(8, '0') }}
              </div>
            </td>
            <td>{{ request.requestType }}</td>
            <td>
              <div class="client-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.clientName }}
              </div>
            </td>
            <td>{{ request.sabClientId }}</td>
            <td>
              <div class="responsable-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.responsable }}
              </div>
            </td>
            <td>{{ request.agency }}</td>
            <td>
              <div class="status-badge status-processing">
                <i class="status-dot"></i>
                Traitable
              </div>
            </td>
            <td class="actions-cell">
              <button class="btn-primary" (click)="processRequest(request)">
                TRAITER
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="no-requests" *ngIf="!(requestsToProcess$ | async) || (requestsToProcess$ | async)!.length === 0">
      <p>Aucune demande Ã  traiter</p>
    </div>
  </div>

  <!-- Section 2: En attente de validation -->
  <div class="workflow-section">
    <div class="section-title">
      <div class="status-icon status-pending">
        <i class="icon-section-placeholder">âœ“</i>
      </div>
      <h3>Demandes en attente de validation</h3>
    </div>
    
    <div class="requests-table" *ngIf="(requestsPendingValidation$ | async) && (requestsPendingValidation$ | async)!.length > 0">
      <table>
        <thead>
          <tr>
            <th style="width: 120px;">NÂ° de demande</th>
            <th style="width: 150px;">Type de demande</th>
            <th style="width: 180px;">Nom Ã  prÃ©nom client</th>
            <th style="width: 120px;">Identifiant SAB</th>
            <th style="width: 180px;">PropriÃ©taire de la demande</th>
            <th style="width: 150px;">Responsable actuel</th>
            <th style="width: 150px;">EntitÃ© propriÃ©taire</th>
            <th style="width: 100px;">Statut</th>
            <th style="width: 100px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of requestsPendingValidation$ | async">
            <td>
              <div class="request-id">
                <div class="request-icon">
                  <i class="icon-row-placeholder">âœ“</i>
                </div>
                {{ request.id.toString().padStart(8, '0') }}
              </div>
            </td>
            <td>{{ request.requestType }}</td>
            <td>
              <div class="client-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.clientName }}
              </div>
            </td>
            <td>{{ request.sabClientId }}</td>
            <td>
              <div class="owner-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.owner }}
              </div>
            </td>
            <td>
              <div class="responsable-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.responsable }}
              </div>
            </td>
            <td>{{ request.agency }}</td>
            <td>
              <div class="status-badge status-waiting">
                <i class="status-dot"></i>
                En attente
              </div>
            </td>
            <td class="actions-cell">
              <button class="btn-primary" (click)="validateRequest(request)">
                VALIDER
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="no-requests" *ngIf="!(requestsPendingValidation$ | async) || (requestsPendingValidation$ | async)!.length === 0">
      <p>Aucune demande en attente de validation</p>
    </div>
  </div>

  <!-- Section 3: Demandes traitÃ©es -->
  <div class="workflow-section" *ngIf="(requestsProcessed$ | async) && (requestsProcessed$ | async)!.length > 0">
    <div class="section-title">
      <div class="status-icon status-processed">
        <i class="icon-section-placeholder">âœ“</i>
      </div>
      <h3>Demandes traitÃ©es</h3>
    </div>
    
    <div class="requests-table">
      <table>
        <thead>
          <tr>
            <th style="width: 120px;">NÂ° de demande</th>
            <th style="width: 120px;">Date crÃ©ation</th>
            <th style="width: 150px;">Type de demande</th>
            <th style="width: 180px;">Client</th>
            <th style="width: 120px;">SAB Client ID</th>
            <th style="width: 150px;">Responsable</th>
            <th style="width: 150px;">Agence</th>
            <th style="width: 100px;">Statut</th>
            <th style="width: 120px;">Valeur dÃ©rogation</th>
            <th style="width: 100px;">Jours en attente</th>
            <th style="width: 100px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of requestsProcessed$ | async">
            <td>
              <div class="request-id">
                <div class="request-icon processed">
                  <i class="icon-row-placeholder">âœ“</i>
                </div>
                {{ request.id.toString().padStart(8, '0') }}
              </div>
            </td>
            <td>{{ request.createdAt }}</td>
            <td>{{ request.requestType }}</td>
            <td>
              <div class="client-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.clientName }}
              </div>
            </td>
            <td>{{ request.sabClientId }}</td>
            <td>
              <div class="responsable-info">
                <div class="user-icon">
                  <i class="icon-user-placeholder">ðŸ‘¤</i>
                </div>
                {{ request.responsable }}
              </div>
            </td>
            <td>{{ request.agency }}</td>
            <td>
              <div class="status-badge status-done">
                <i class="status-dot"></i>
                TraitÃ©
              </div>
            </td>
            <td>{{ formatPrice(request.derogationValue) }}</td>
            <td>
              <span class="days-count">
                {{ request.daysPending }} jour{{ request.daysPending > 1 ? 's' : '' }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="btn-secondary" (click)="viewRequest(request)">
                VOIR
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>